'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ArgsAdjustingMessageHandler = undefined;

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get3 = require('babel-runtime/helpers/get');

var _get4 = _interopRequireDefault(_get3);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

exports.default = createArgsAdjuster;

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _delegate = require('./delegate');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ArgsAdjustingMessageHandler = exports.ArgsAdjustingMessageHandler = function (_DelegatingMessageHan) {
  (0, _inherits3.default)(ArgsAdjustingMessageHandler, _DelegatingMessageHan);

  function ArgsAdjustingMessageHandler() {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var children = arguments[1];
    (0, _classCallCheck3.default)(this, ArgsAdjustingMessageHandler);

    var _this = (0, _possibleConstructorReturn3.default)(this, (ArgsAdjustingMessageHandler.__proto__ || (0, _getPrototypeOf2.default)(ArgsAdjustingMessageHandler)).call(this, options, children));

    if (!options.adjustArgs) {
      throw new TypeError('Missing required "adjustArgs" option.');
    }
    _this.adjustArgs = options.adjustArgs || {};
    return _this;
  }

  // Adjust args, and pass the new args into the message handler.


  (0, _createClass3.default)(ArgsAdjustingMessageHandler, [{
    key: 'handleMessage',
    value: function handleMessage() {
      var _get2;

      var newArgs = this.adjustArgs.apply(this, arguments);
      if (!Array.isArray(newArgs)) {
        return _bluebird2.default.reject(new Error('adjustArgs must return an array (of arguments).'));
      }
      return (_get2 = (0, _get4.default)(ArgsAdjustingMessageHandler.prototype.__proto__ || (0, _getPrototypeOf2.default)(ArgsAdjustingMessageHandler.prototype), 'handleMessage', this)).call.apply(_get2, [this].concat((0, _toConsumableArray3.default)(newArgs)));
    }
  }]);
  return ArgsAdjustingMessageHandler;
}(_delegate.DelegatingMessageHandler);

function createArgsAdjuster() {
  for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
    args[_key] = arguments[_key];
  }

  return new (Function.prototype.bind.apply(ArgsAdjustingMessageHandler, [null].concat(args)))();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tZXNzYWdlLWhhbmRsZXIvYXJncy1hZGp1c3Rlci5qcyJdLCJuYW1lcyI6WyJjcmVhdGVBcmdzQWRqdXN0ZXIiLCJBcmdzQWRqdXN0aW5nTWVzc2FnZUhhbmRsZXIiLCJvcHRpb25zIiwiY2hpbGRyZW4iLCJhZGp1c3RBcmdzIiwiVHlwZUVycm9yIiwibmV3QXJncyIsIkFycmF5IiwiaXNBcnJheSIsInJlamVjdCIsIkVycm9yIiwiYXJncyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7a0JBd0J3QkEsa0I7O0FBeEJ4Qjs7OztBQUNBOzs7O0lBRWFDLDJCLFdBQUFBLDJCOzs7QUFFWCx5Q0FBb0M7QUFBQSxRQUF4QkMsT0FBd0IsdUVBQWQsRUFBYztBQUFBLFFBQVZDLFFBQVU7QUFBQTs7QUFBQSxnTEFDNUJELE9BRDRCLEVBQ25CQyxRQURtQjs7QUFFbEMsUUFBSSxDQUFDRCxRQUFRRSxVQUFiLEVBQXlCO0FBQ3ZCLFlBQU0sSUFBSUMsU0FBSixDQUFjLHVDQUFkLENBQU47QUFDRDtBQUNELFVBQUtELFVBQUwsR0FBa0JGLFFBQVFFLFVBQVIsSUFBc0IsRUFBeEM7QUFMa0M7QUFNbkM7O0FBRUQ7Ozs7O29DQUN1QjtBQUFBOztBQUNyQixVQUFNRSxVQUFVLEtBQUtGLFVBQUwsdUJBQWhCO0FBQ0EsVUFBSSxDQUFDRyxNQUFNQyxPQUFOLENBQWNGLE9BQWQsQ0FBTCxFQUE2QjtBQUMzQixlQUFPLG1CQUFRRyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLGlEQUFWLENBQWYsQ0FBUDtBQUNEO0FBQ0QsMlBBQThCSixPQUE5QjtBQUNEOzs7OztBQUlZLFNBQVNOLGtCQUFULEdBQXFDO0FBQUEsb0NBQU5XLElBQU07QUFBTkEsUUFBTTtBQUFBOztBQUNsRCw0Q0FBV1YsMkJBQVgsZ0JBQTBDVSxJQUExQztBQUNEIiwiZmlsZSI6ImFyZ3MtYWRqdXN0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHJvbWlzZSBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQge0RlbGVnYXRpbmdNZXNzYWdlSGFuZGxlcn0gZnJvbSAnLi9kZWxlZ2F0ZSc7XG5cbmV4cG9ydCBjbGFzcyBBcmdzQWRqdXN0aW5nTWVzc2FnZUhhbmRsZXIgZXh0ZW5kcyBEZWxlZ2F0aW5nTWVzc2FnZUhhbmRsZXIge1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSwgY2hpbGRyZW4pIHtcbiAgICBzdXBlcihvcHRpb25zLCBjaGlsZHJlbik7XG4gICAgaWYgKCFvcHRpb25zLmFkanVzdEFyZ3MpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgXCJhZGp1c3RBcmdzXCIgb3B0aW9uLicpO1xuICAgIH1cbiAgICB0aGlzLmFkanVzdEFyZ3MgPSBvcHRpb25zLmFkanVzdEFyZ3MgfHwge307XG4gIH1cblxuICAvLyBBZGp1c3QgYXJncywgYW5kIHBhc3MgdGhlIG5ldyBhcmdzIGludG8gdGhlIG1lc3NhZ2UgaGFuZGxlci5cbiAgaGFuZGxlTWVzc2FnZSguLi5hcmdzKSB7XG4gICAgY29uc3QgbmV3QXJncyA9IHRoaXMuYWRqdXN0QXJncyguLi5hcmdzKTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobmV3QXJncykpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ2FkanVzdEFyZ3MgbXVzdCByZXR1cm4gYW4gYXJyYXkgKG9mIGFyZ3VtZW50cykuJykpO1xuICAgIH1cbiAgICByZXR1cm4gc3VwZXIuaGFuZGxlTWVzc2FnZSguLi5uZXdBcmdzKTtcbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZUFyZ3NBZGp1c3RlciguLi5hcmdzKSB7XG4gIHJldHVybiBuZXcgQXJnc0FkanVzdGluZ01lc3NhZ2VIYW5kbGVyKC4uLmFyZ3MpO1xufVxuIl19
